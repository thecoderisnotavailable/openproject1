<div class="container px-6 mx-auto grid">
  <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">
      Students
  </h2>
  <div class="px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800">
      <div class="relative text-gray-500 focus-within:text-purple-600">
          <input id="searchBar" class="block w-full pr-20 mt-1 text-sm text-black dark:text-gray-300 dark:border-gray-600 dark:bg-gray-700 focus:border-purple-400 focus:outline-none focus:shadow-outline-purple dark:focus:shadow-outline-gray form-input" placeholder="Search for students">
          <button id="searchBtn" class="absolute inset-y-0 right-0 px-4 text-sm font-medium leading-5 text-white transition-colors duration-150 bg-purple-600 border border-transparent rounded-r-md active:bg-purple-600 hover:bg-purple-700 focus:outline-none focus:shadow-outline-purple">
            Search
          </button>
      </div>
  </div>
  <div class="w-full overflow-hidden rounded-lg shadow-xs">
      <div class="w-full overflow-x-auto">
        <table class="w-full whitespace-no-wrap">
          <thead>
            <tr class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800">
              <th class="px-4 py-3">Name</th>
              <th class="px-4 py-3">Applications</th>
              <th class="px-4 py-3">In Process</th>
              <th class="px-4 py-3">Date</th>
              <th class="px-4 py-3">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800" id="tbody">
          </tbody>
        </table>
      </div>
      <div class="grid px-4 py-3 text-xs font-semibold tracking-wide text-gray-500 uppercase border-t dark:border-gray-700 bg-gray-50 sm:grid-cols-12 dark:text-gray-400 dark:bg-gray-800">
        <span class="flex col-span-4 mt-2 sm:mt-auto sm:justify-end">
          <nav aria-label="Table navigation">
            <ul class="inline-flex items-center" id="list">...</ul>
          </nav>
        </span>
      </div>
  </div>
</div>
<data id="Res" class="hidden" hidden>{{Res}}</data>
<template id="tr" class="hidden" hidden>
  <tr class="text-gray-700 dark:text-gray-400">
    <td class="px-4 py-3">
      <div class="flex items-center text-sm">
        <div class="relative hidden w-8 h-8 mr-3 rounded-full md:block">
          <img class="object-cover w-full h-full rounded-full" src="https://avatars.dicebear.com/api/avataaars/${firstN}.svg?background=%23b49dda" alt="" loading="lazy">
          <div class="absolute inset-0 rounded-full shadow-inner" aria-hidden="true"></div>
        </div>
        <div>
          <p class="font-semibold">${firstN} ${midN} ${lastN}</p>
          <p class="text-xs text-gray-600 dark:text-gray-400">
            ${email}
          </p>
        </div>
      </div>
    </td>
    <td class="px-4 py-3 text-sm">
      ${appln}
    </td>
    <td class="px-4 py-3 text-xs">
      ${inpro}
    </td>
    <td class="px-4 py-3 text-sm">
      ${at}
    </td>
    <td class="px-4 py-3">
      <div class="flex items-center space-x-4 text-sm">
        <button class="flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="Edit" onclick="action(101, ${id})">
          <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
          </svg>
        </button>
        <button class="flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="Delete" onclick="action(102, ${id})">
          <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
        </button>
        <button class="flex items-center justify-between px-2 py-2 text-sm font-medium leading-5 text-purple-600 rounded-lg dark:text-gray-400 focus:outline-none focus:shadow-outline-gray" aria-label="View" onclick="action(102, ${id})">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="w-5 h-5" viewBox="0 0 16 16">
            <path d="M13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14h10.348a2 2 0 0 0 1.991-1.819l.637-7A2 2 0 0 0 13.81 3zM2.19 3c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672a1 1 0 0 1 .707.293L7.586 3H2.19zm9.608 5.271-3.182 1.97c-.27.166-.616-.036-.616-.372V9.1s-2.571-.3-4 2.4c.571-4.8 3.143-4.8 4-4.8v-.769c0-.336.346-.538.616-.371l3.182 1.969c.27.166.27.576 0 .742z"/>
          </svg>
        </button>
      </div>
    </td>
  </tr>
</template>
<template id="listZero" class="hidden" hidden>
  <li>
    <button onclick="update(${less})" class="px-3 py-1 rounded-md rounded-l-lg focus:outline-none focus:shadow-outline-purple" aria-label="Previous">
      <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 20 20">
        <path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path>
      </svg>
    </button>
  </li>
  ${list}
  <li>
    <button onclick="update(${more})" class="px-3 py-1 rounded-md rounded-r-lg focus:outline-none focus:shadow-outline-purple" aria-label="Next">
      <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 20 20">
        <path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path>
      </svg>
    </button>
  </li>
</template>
<template id="listStart" class="hidden" hidden>
  <li>
    <button onclick="update(${num})" class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple ${cls}">
      ${show}
    </button>
  </li>
</template>
<template id="listEnd" class="hidden" hidden>
  <li>
    <span class="px-3 py-1">...</span>
  </li>
  <li>
    <button onclick="update(${num})" class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple">
      ${show}
    </button>
  </li>
</template>
<button onclick="buttonHandler()" title="New Student" style="bottom: 10px; right: 10px; width:30px; height: 30px;" class="fixed z-90 bg-blue-600 px-3 rounded-full flex justify-center items-center text-white animate-bounce">&#43;</button>
<script tag="init">
    window.mtab="students";
</script>
<script tag="fab">
  function buttonHandler(){
    window.location = "/r/student/new";
  }
</script>
<script tag="template">
  var ids = {
    search: "searchBtn",
    tbody: "tbody",
    tr: "tr",
    tlistZero: "listZero",
    tlistStart: "listStart",
    tlistEnd: "listEnd",
    list: "list",
    res: "Res",
    searchBar: "searchBar"
  };
  function template(template, values, filter = (v)=>v){
    var keys = Object.keys(values);
    for (let i = 0; i < keys.length; i++) {
      template = template.replaceAll('${' + keys[i] + '}', filter(values[keys[i]]));
    }
    return template;
  }
  function set(id, value){
    $('#' + id)[0].innerHTML = value;
  }
  function getTemplate(id){
    return $('#' + id)[0].innerHTML;
  }
  function readJSON(id){
    return JSON.parse($('#' + id)[0].innerHTML);
  }
  function rm(id){
    $('#' + id)[0].remove();
  }
  function clean(id){
    $('#' + id)[0].innerHTML = "";
  }
  function addAfter(id, html){
    $('#' + id)[0].innerHTML += html;
  }
</script>
<script tag="render">
  function renderData(){
    var data = window.page.data;
    clean(ids.tbody);
    if(data.length == 0){
      addAfter(ids.tbody, "<tr><td colspan=\"5\" class=\"text-gray-700 dark:text-gray-400 p-4\">Nothing Found â˜¹!</td></tr>");
      return;
    }
    for (let i = 0; i < data.length; i++) {
      addAfter(ids.tbody, template(
        getTemplate(ids.tr), data[i], (v)=> v || ""
      ));
    }
  }
  function renderMeta(){
    var meta = window.page.meta;
    var index = window.page.index;
    const total = Math.floor((parseInt(meta.total) + parseInt(meta.per) - 1) / parseInt(meta.per));
    clean(ids.list);
    if(meta.total == 0) return;
    /**
     * index
     * < 1 2 3 ... 5 >
     * [index-1] [index] [index + 1] [index + 2] ... [index.length-1] [index + 1]
     * 
     * */
    var start = "";
    var istart = index - 1 == -1 ? 0 : index + 2 > total ? index == total - 1 ? index-2 : index-2 : index - 1;
    if(istart < 0) istart = 0;
    for (let i = istart; i < istart + 3; i++) {
      var cls = "";
      if(i < total){
        if(i == index) {
          cls = "text-white transition-colors duration-150 bg-purple-600 border border-r-0 border-purple-600 rounded-md";
        }
        start += template(getTemplate(ids.tlistStart), {num: i, show: i + 1, cls: cls});
      }
    }
    var end = "";
    if(total > index + 2){
      end = template(getTemplate(ids.tlistEnd), {num: total - 1, show: total});
    }
    addAfter(ids.list, template(getTemplate(ids.tlistZero),
    {
      less: index - 1 > 0 ? index - 1 : 0,
      list: start + end,
      more: index + 1 < total ? index + 1 : total - 1
    }));
  }
</script>
<script tag="get">
  function update(page){
    get({
      page: page,
      q: window.page.meta.query || ""
    });
  }
  function doSearch(){
    get({
      page: 0,
      q: $('#' + ids.searchBar)[0].value || ""
    });
  }
  function get(params){
    var formData = new FormData();
    formData.append(101, params.page || 0);
    formData.append(102, params.q || "");
    fetch('/api/student/list/get', {
          method: "POST",
          body: formData,
          headers: {
            'REQUESTX': 'xmlhttprequest',
          },
          body: formData,
        }).then(res=>res.json())
          .then(res=>{
            window.page.data = res.data;
            if(res.meta != null)
              window.page.meta = res.meta;
            if(params.q){
              window.page.meta.query = params.q;
            }
            window.page.index = params.page;
            renderData();
            renderMeta();
          }).catch(e=>{
            console.log(e)
          });
  }
</script>
<script tag="init">
  if(!String.prototype.replaceAll){
    String.prototype.replaceAll = function(search, replacement) {
        var target = this;
        return target.split(search).join(replacement);
    };
  }
  $('#'+ids.search).on('click', doSearch);
  window.page = new Object();
  window.page = {...readJSON(ids.res)};
  window.page.index = 0;
  window.page.meta.query = "";
  renderData();
  renderMeta();
</script>
<script tag="action">
  function action(act, data){
    switch (act){
      case 101:
        window.location = "/r/student/edit?student=" + data;
        return;
    }
  }
</script>